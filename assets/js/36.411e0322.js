(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{523:function(s,t,a){s.exports=a.p+"assets/img/NativeRPC.55ab5af2.png"},524:function(s,t,a){s.exports=a.p+"assets/img/NativeRPC-UML.2e78c51a.svg"},525:function(s,t,a){s.exports=a.p+"assets/img/RPCMessage.b5a3ed02.png"},572:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("现代 App 中通常会引入像 WebView、React Native、Flutter 这样的跨端解决方案，它们可以快速地实现功能的开发和上线。在使用这些方案时，都不可避免的会有一些功能需要使用 Native 能力，在涉及调用应用的 Native 能力的时候，它们都会采用一套自己独立的通信方式，对不同跨端方式提供 Native 能力的时候，不能实现完全的代码复用。本文主要介绍参考大厂相关跨端基建设计的一个统一跨端通信框架，对应用抹除跨端技术差异，实现 Native 资产复用。")]),s._v(" "),t("h2",{attrs:{id:"整体架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#整体架构"}},[s._v("#")]),s._v(" 整体架构")]),s._v(" "),t("p",[s._v("框架借鉴服务端 RPC 协议概念，设计了 NativeRPC 协议。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(523),alt:"NativeRPC"}})]),s._v(" "),t("p",[s._v("原生侧将应用的一些基础能力封装为 NativeRPCService，并注册到 ServiceCenter 中。跨端应用侧通过和原生侧建立 NativeRPCConnection，来实现 NativeRPC 的调用。")]),s._v(" "),t("p",[s._v("通信方面，跨端侧和原生侧都需要实现一个 NativeRPCStub，用于实现 RPC 请求和响应数据的解析和组装。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(524),alt:"UML"}})]),s._v(" "),t("h2",{attrs:{id:"通信协议部分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通信协议部分"}},[s._v("#")]),s._v(" 通信协议部分")]),s._v(" "),t("p",[t("img",{attrs:{src:a(525),alt:"Message"}})]),s._v(" "),t("p",[s._v("请求数据如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_meta"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"callbackId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15667769")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"method"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addCourse"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"service"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"course.storage"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"params"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("meta 部分对应 UML 中的 NativeRPCMessageMeta，代表 RPC 消息的元数据。包含 callbackId 和 event 两个都是可空，分别对应正常调用和事件通知。callbackId 用于标记请求序列号，返回 Response 时，也需要带上 callbackId，用于跨端侧匹配回调。service 对应注册到 ServiceCenter 中的服务代号，method 是方法代号。params 是一个 map 类型的数据，在调用方法的是会传入。")]),s._v(" "),t("p",[s._v("response 数据如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_meta"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"callbackId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15667769")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"code"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"通信全流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通信全流程"}},[s._v("#")]),s._v(" 通信全流程")]),s._v(" "),t("p",[s._v("TODO：")])])}),[],!1,null,null,null);t.default=n.exports}}]);