(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{519:function(s,t,a){s.exports=a.p+"assets/img/podfile_split.e5c468c9.png"},572:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"podfile-拆分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#podfile-拆分"}},[s._v("#")]),s._v(" Podfile 拆分")]),s._v(" "),t("p",[s._v("随着业务不断迭代，代码急剧膨胀，我们往往会对项目中的部分业务模块进行组件化的拆分，对底层的业务基础库做封装，项目的 Podfile 也会变得异常臃肿。其实可以根据 Pod 的类型，将 Podfile 拆到各个子文件中，例如 "),t("code",[s._v("Podfile.foundation")]),s._v("、"),t("code",[s._v("Podfile.business")]),s._v("这种。只需要把 pod 按照分类放到项目里的不同类型文件下，并在 Podfile 中读取相关的文件即可。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Podfile")]),s._v("\ntarget "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TokenCourse'")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  use_frameworks"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取Podfile.foundation里的内容")]),s._v("\n  eval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("open"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Podfile.foundation'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Podfile.foundation'")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Podfile.foundation")]),s._v("\npod "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RxSwift'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'6.5.0'")])]),s._v("\npod "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RxCocoa'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'6.5.0'")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"添加相关文件到-xcode-工程中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加相关文件到-xcode-工程中"}},[s._v("#")]),s._v(" 添加相关文件到 Xcode 工程中")]),s._v(" "),t("p",[s._v("但是在"),t("code",[s._v("pod install")]),s._v("的时候，这些带后缀的 Podfile 并不会在 xcode 中显示，每次都需要手动添加并设置文件类型。其实 CocoaPods 有提供一个 Hook 函数"),t("code",[s._v("post_install")]),s._v("，它允许我们在项目被写入硬盘之前做一些事情。我们可以在这里将自定义的 Podfile 文件添加到项目中，并设置文件类型为 ruby 脚本。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[s._v("post_install "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("installer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在生成的 pods.xcodeproj 中添加文件 Podfile.*相关文件")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不添加Podfile.lock")]),s._v("\n  file_paths "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("glob"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__FILE__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Podfile.*"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("f"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("end_with"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.lock'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  file_paths"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("file_path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n     file_reference "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" installer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pods_project"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("new_file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置文件类型为ruby脚本")]),s._v("\n     file_reference"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("set_explicit_file_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text.script.ruby'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  installer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pods_project"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("img",{attrs:{src:a(519),alt:"xcode"}})]),s._v(" "),t("p",[s._v("感觉把这部分放到一个 CocoaPods 插件里会更合适 🤔️。")]),s._v(" "),t("h2",{attrs:{id:"pod-修改优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod-修改优化"}},[s._v("#")]),s._v(" Pod 修改优化")]),s._v(" "),t("p",[s._v("在开发的时候，我们常常会对干这样的事情，将依赖的远程 pod 改为本地的 pod，来对它进行修改。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod 'UniFoundation', '~> 0.0.3'")]),s._v("\npod "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UniFoundation'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../UniFoundation'")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("每次还要找到对应的 pod 写在哪里，尤其是当有些 pod 是其他库引入的时候，就更麻烦了。例如我们在 "),t("code",[s._v("AppModule")]),s._v("这个库中引入了"),t("code",[s._v("Yams")]),s._v("这个库。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[s._v("Pod"),t("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n  s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'AppModule'")])]),s._v("\n  s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("version          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.1'")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n  s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dependency "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Yams'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'~> 4.0'")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("当我们想在本地去改"),t("code",[s._v("Yams")]),s._v("这个库，而不去改"),t("code",[s._v("AppModule")]),s._v("的话，就会发生这样的状况。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Podfile")]),s._v("\npod "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'AppModule'")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地开发")]),s._v("\npod "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Yams'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../Yams'")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("执行"),t("code",[s._v("pod install")]),s._v("的时候，会出现下面的报错。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" CocoaPods could not "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" compatible versions "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" pod "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Yams"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  In Podfile:\n    AppModule was resolved to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".1, "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" depends on\n      Yams "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("~"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    Yams "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/Yams"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("非常烦 😭，要是能在安装依赖的时候，自动替换成下面这个本地路径的就好了。首先 Hook 函数是做不到的，"),t("code",[s._v("pre_install")]),s._v(" 和 "),t("code",[s._v("post_install")]),s._v("两个 Hook 函数，分别对应 Pods 工程安装前和安装后，我们这里属于是在 Analyze 阶段就 🐔 了。")]),s._v(" "),t("h3",{attrs:{id:"cocoapods-源码分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cocoapods-源码分析"}},[s._v("#")]),s._v(" CocoaPods 源码分析")]),s._v(" "),t("p",[s._v("这里看了一篇字节技术团队的文章"),t("a",{attrs:{href:"https://mp.weixin.qq.com/s/Pt6pcxKCHhdnnWPYrToNvA",target:"_blank",rel:"noopener noreferrer"}},[s._v("《抖音研发效能建设 - CocoaPods 优化实践？》"),t("OutboundLink")],1),s._v("，讲解了 CocoaPods 的"),t("code",[s._v("pod install")]),s._v("的整个流程。")]),s._v(" "),t("p",[s._v("通过查看 analyzer 里的依赖数据流向，找到了下面的这个方法。里面调用了 target_definition.dependencies 来获取了相关的依赖。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("from_podfile")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("podfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" ArgumentError"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Must be initialized with a podfile'")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" podfile\n  podfile_dependencies "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  dependencies_by_target_definition "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  podfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target_definition_list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("target_definition"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取依赖")]),s._v("\n    deps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target_definition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze\n    podfile_dependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concat deps\n    dependencies_by_target_definition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("target_definition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" deps\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  podfile_dependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uniq"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("podfile_dependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dependencies_by_target_definition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("dependencies 方法定义在"),t("code",[s._v("Pod::Podfile::TargetDefinition")]),s._v("这个类里。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @return [Array<Dependency>] The list of the dependencies of the target")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         definition including the inherited ones.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dependencies")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exclusive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n    non_inherited_dependencies\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    non_inherited_dependencies "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dependencies\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"dependencies-方法替换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dependencies-方法替换"}},[s._v("#")]),s._v(" dependencies 方法替换")]),s._v(" "),t("p",[s._v("在 Ruby 中，我们可以使用"),t("code",[s._v("alias_method")]),s._v("将一个方法的名称从一个类中移除，并将其替换为另一个方法的名称。这里对 dependencies 方法进行下重写，将返回的 Array 里本地开发的 pod 给替换掉。")]),s._v(" "),t("p",[s._v("首先，定义了一个 Hash 用于存储，key 为 pod 的 name，value 为 "),t("code",[s._v("Dependency")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储所有override的pod信息，key为name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$override_hash")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Hash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("override_pod")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("requirements"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  puts "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Override Pod ')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("#{")]),t("span",{pre:!0,attrs:{class:"token content"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yellow\n\n  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$override_hash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Pod"),t("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("requirements"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  pod name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("requirements\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("再替换一下 dependencies 方法。")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Pod")]),t("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[s._v("::")]),s._v("Podfile"),t("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[s._v("::")]),s._v("TargetDefinition\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 覆盖原有的dependencies方法")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://www.rubydoc.info/github/CocoaPods/Core/master/Pod/Podfile/TargetDefinition#dependencies-instance_method")]),s._v("\n  alias_method "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":origin_dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":dependencies")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dependencies")])]),s._v("\n    deps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" origin_dependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("map "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("it"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$override_hash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("has_key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("it"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$override_hash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("it"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":it")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" deps\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),t("p",[s._v("https://www.rubydoc.info/github/CocoaPods/Core/master/Pod/Specification/Consumer#dependencies-instance_method")])])}),[],!1,null,null,null);t.default=e.exports}}]);